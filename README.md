# Кастомный пул потоков (Custom Thread Pool Executor)

В рамках данного проекта реализовала высоконагруженный пул потоков с расширенными возможностями управления задачами, балансировкой нагрузки и гибкой настройкой параметров. Пул разработан как альтернатива стандартному `ThreadPoolExecutor` с дополнительными функциями, такими как:

- Поддержка нескольких очередей задач.
- Настраиваемые алгоритмы балансировки.
- Гибкие политики отказа.
- Подробное логирование всех событий.

## Основные возможности

### 1. Параметры пула
- **corePoolSize**: Базовое количество потоков.
- **maxPoolSize**: Максимальное количество потоков.
- **keepAliveTime**: Время простоя потока до завершения.
- **queueSize**: Максимальный размер очереди задач.
- **minSpareThreads**: Минимальное количество резервных потоков.

### 2. Алгоритмы балансировки
- **Round Robin**: Циклическое распределение задач между очередями.
- **Least Loaded**: Выбор очереди с наименьшей загрузкой.

### 3. Политики отказа
- **AbortPolicy**: Выбрасывает исключение при перегрузке.
- **CallerRunsPolicy**: Выполняет задачу в потоке вызывающего.
- **DiscardPolicy**: Молча игнорирует переполнение.

### 4. Логирование
Подробное логирование всех ключевых событий:
- Создание и завершение потоков.
- Добавление задач в очередь.
- Выполнение задач.
- Обработка отказов.

## Производительность

### Сравнение с ThreadPoolExecutor
Кастомный пул демонстрирует сравнимую производительность с `ThreadPoolExecutor` при следующих условиях:
- Нагрузка до 1000 задач в секунду.
- Оптимальные настройки параметров (см. ниже).

Преимущества:
- Более гибкое управление очередями.
- Возможность балансировки нагрузки между несколькими очередями.

Недостатки:
- Небольшие накладные расходы из-за дополнительной логики балансировки.

### Оптимальные параметры
На основе тестирования рекомендуются следующие настройки:
| Параметр       | Значение для CPU-bound задач | Значение для IO-bound задач |
|----------------|-----------------------------|----------------------------|
| corePoolSize   | Число ядер CPU              | Число ядер CPU × 2         |
| maxPoolSize    | corePoolSize × 2            | corePoolSize × 4           |
| queueSize      | 100-500                     | 1000-2000                  |
| minSpareThreads| corePoolSize / 2            | corePoolSize               |

## Принцип работы

1. **Поступление задачи**:
    - Задача распределяется в очередь с помощью выбранного балансировщика.
    - Если все очереди заполнены, создается новый поток (если не достигнут maxPoolSize).

2. **Обработка задач**:
    - Каждый рабочий поток (Worker) берет задачи из своей очереди.
    - При простое дольше keepAliveTime лишние потоки завершаются.

3. **Перегрузка**:
    - При достижении maxPoolSize и заполнении очередей применяется выбранная политика отказа.

## Запуск проекта
1. Клонировать репозиторий

2. Собрать проект: mvn clean install

3. Запустить демо: java -cp target/classes org.example.demo.Main

4. Логи будут записаны в logs/threadpool.log

## Демонстрация

Пример использования:
```java
CustomThreadPoolExecutor executor = new CustomThreadPoolExecutor(
    2, 4, 5, TimeUnit.SECONDS,
    10, 1, new CustomThreadFactory(),
    new AbortPolicy(), new RoundRobinBalancer()
);

executor.execute(() -> {
    System.out.println("Task executed");
});

executor.shutdown();

